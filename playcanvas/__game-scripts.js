var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){var t=this.entity.getPosition();this.vec=new pc.Vec3(t.x,t.y,t.z)},Follow.prototype.update=function(t){if(this.target){var e=this.target.getPosition();e.z=Math.max(2,e.z+.75*this.distance),e.x=0,e.y=3,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone(),this.app.on("app:teleportRequest",this.teleportRequestReceivedHandler,this)},Teleportable.prototype.update=function(t){this.entity.getPosition().y<1&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo,!0)},Teleportable.prototype.teleportRequestReceivedHandler=function(t){t===this.entity&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.teleport=function(t,e,i){var o=new pc.Vec3;if(!(t&&Date.now()-this.lastTeleport<500)){if(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:(o.x=this.startPosition.x,o.y=this.startPosition.y,o.z=this.startPosition.z),!0===i){var l=.3*Math.random();o.x+=Math.random()>.5?-l:l}this.entity.rigidbody.teleport(o),this.entity.rigidbody.linearVelocity=this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO,this.entity.fire("teleportable:reposition")}};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){this.app.fire("app:teleportRequest",t)};var Score=pc.createScript("score");Score.attributes.add("points",{type:"number",title:"Points Value",description:"Number of points that collision with this entitiy is worth",default:0}),Score.attributes.add("freeBall",{type:"boolean",title:"Free Ball",description:"Is a Free Ball awarded?",default:!1}),Score.attributes.add("scoreIndicator",{type:"entity",title:"Score Indicator",description:"Score Indicator Entity, blinks when triggered"}),Score.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.app.on("app:gameOver",this.killBlink,this)},Score.prototype.onTriggerEnter=function(){var t,e,i=this;this.points>0&&this.app.fire("app:score",this.points),!0===this.freeBall&&this.app.fire("app:freeBall"),void 0!==this.scoreIndicator&&(t=this.scoreIndicator,e=0,function blink(){e++,(t.model||t.element).enabled=e%2==1,e<7&&(i.blinkTimeout=setTimeout(blink,200))}())},Score.prototype.killBlink=function(){clearTimeout(this.blinkTimeout),this.scoreIndicator&&((this.scoreIndicator.model||this.scoreIndicator.element).enabled=!0)};var Main=pc.createScript("main");Main.attributes.add("totalBalls",{type:"number",title:"Total Balls",description:"Number of balls thrown in a game",default:0}),Main.attributes.add("scoreEntity",{type:"entity",title:"Score-Keeping Text Entity"}),Main.attributes.add("ballCountEntity",{type:"entity",title:"Ball-Counting Text Entity"}),Main.attributes.add("messageEntity",{type:"entity",title:"Message Text Entity"}),Main.prototype.initialize=function(){void 0!==window.totalBalls&&(this.totalBalls=window.totalBalls),this.score=0,this.initGame=!0,this.totalBalls+=1,this.checkGameOver=this.checkGameOver.bind(this),this.alertRestart=this.alertRestart.bind(this),this.showMessage=this.showMessage.bind(this),this.hideMessage=this.hideMessage.bind(this),this.restartGame=this.restartGame.bind(this),window.restartGame=this.restartGame,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.resetPosition,this),this.app.on("app:score",this.scoreReceivedHandler,this),this.app.on("app:ballReturned",this.countBall,this),this.app.on("app:freeBall",this.receiveFreeBallHandler,this),this.restartGame(),this.setBallCount(this.totalBalls),this.initGame=!1},Main.prototype.resetPosition=function(t){!0===this.gameOver&&t.key===pc.KEY_R&&this.restartGame(),t.event.preventDefault()},Main.prototype.restartGame=function(t){this.gameOver=!1,this.setBallCount(this.initGame?this.totalBalls+1:this.totalBalls-1),this.setScore(0),this.hideMessage(),this.recordedRollsArray=[],setTimeout(this.alertRestart,10)},Main.prototype.alertRestart=function(){this.app.fire("app:restartGame")},Main.prototype.receiveFreeBallHandler=function(){this.showMessage("+1XTRA"),this.changeBallCount(1)},Main.prototype.countBall=function(t){var e=this.totalBalls-this.ballsLeft;!0!==this.recordedRollsArray[e]&&this.ballsLeft<this.totalBalls&&window.MobileFuse.sendMessage("roll"+e),this.recordedRollsArray[e]=!0,this.changeBallCount(-1),setTimeout(this.checkGameOver,200)},Main.prototype.changeBallCount=function(t){this.ballsLeft=Math.max(0,this.ballsLeft+t),1===this.ballsLeft&&this.blink(this.ballCountEntity),this.setBallCount(this.ballsLeft)},Main.prototype.setBallCount=function(t){this.ballsLeft=t;var e=!0===window.MobileFuse.PC_CONFIG.spanish?"PELOTA":"BALL";this.ballCountEntity&&(this.ballCountEntity.element.text=this.ballsLeft+" "+e+(1!==this.ballsLeft?"S":""))},Main.prototype.checkGameOver=function(t){if(0===this.ballsLeft&&!1===this.gameOver){this.gameOver=!0,this.app.fire("app:gameOver"),this.blink(this.scoreEntity),this.blink(this.ballCountEntity),window.MobileFuse.sendMessage("gameOver");var e=!0===window.MobileFuse.PC_CONFIG.spanish?"FIN DE LA\nPARTIDA":"GAME\nOVER";this.gameOverMessage=this.showMessage(e,-1)}},Main.prototype.scoreReceivedHandler=function(t){this.setScore(this.score+t)},Main.prototype.setScore=function(t){this.score=t,this.scoreEntity&&(this.scoreEntity.element.text=this.score+"X")},Main.prototype.showMessage=function(t,e){void 0===e&&(e=1.5),this.messageEntity&&(this.messageEntity.element.text=t,this.messageEntity.enabled=!0,e>0&&setTimeout(this.hideMessage,1e3*e))},Main.prototype.hideMessage=function(){this.messageEntity&&(this.messageEntity.enabled=!1)},Main.prototype.blink=function(t){var e=0;!function toggle(){e++,m=t.model||t.element,m.enabled=e%2==1,e<9&&setTimeout(toggle,250)}()};var DragRoll=pc.createScript("dragRoll");DragRoll.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),DragRoll.attributes.add("floorEntity",{type:"entity",title:"Floor Entity"}),DragRoll.attributes.add("arrowEntity",{type:"entity",title:"Arrow Entity"}),DragRoll.attributes.add("maxForce",{type:"number",title:"Max Force",description:"Maximum clamp value for ball force",default:10}),DragRoll.attributes.add("minForce",{type:"number",title:"Min Force",description:"Minimum clamp value for ball force",default:3.5}),DragRoll.attributes.add("dragVelXMultiplier",{type:"number",title:"Drag Vel X Multiplier",description:"Drag velocity factor - x axis",default:.05}),DragRoll.attributes.add("dragVelZMultiplier",{type:"number",title:"Drag Vel Z Multiplier",description:"Drag velocity factor - z axis",default:.1}),DragRoll.prototype.initialize=function(){this.ray=new pc.Ray,this.dragging=this.rolling=!1,this.enabled=!0,this.resetArrow=this.resetArrow.bind(this),this.app.touch?(this.app.touch.on(pc.EVENT_TOUCHSTART,this.touchStartHandler,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.touchEndHandler,this)):this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.mouseDownHandler,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.mouseUpHandler,this)),this.app.mouse.disableContextMenu(),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.resetPosition,this),this.entity.on("teleportable:reposition",this.repositionHandler,this),this.app.on("app:gameOver",this.gameOverHandler,this),this.app.on("app:restartGame",this.gameRestartHandler,this),this.repositionHandler()},DragRoll.prototype.update=function(){!0===this.rolling&&0===this.entity.rigidbody.linearVelocity.z&&this.entity.rigidbody.applyImpulse(new pc.Vec3(-.5,-10,-.5))},DragRoll.prototype.resetPosition=function(t){!0===this.enabled&&t.key===pc.KEY_R&&this.entity.setPosition(0,0,0),t.event.preventDefault()},DragRoll.prototype.repositionHandler=function(t){var e=this.entity.getPosition();this.cursorVelArray=[],this.side0=this.side1=0,this.app.fire("app:ballReturned"),this.arrowEntity.setPosition(e.x,this.arrowEntity.getPosition().y,e.z),this.rolling=!1},DragRoll.prototype.touchStartHandler=function(t){!1!==this.enabled&&(this.app.touch.on(pc.EVENT_TOUCHMOVE,this.cursorMoveHandler,this),this.cursorMoveHandler(t.touches[0]),t.event.preventDefault())},DragRoll.prototype.mouseDownHandler=function(t){!1!==this.enabled&&t.button===pc.MOUSEBUTTON_LEFT&&(this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.cursorMoveHandler,this),this.cursorMoveHandler(t))},DragRoll.prototype.touchEndHandler=function(t){this.app.touch.off(pc.EVENT_TOUCHMOVE,this.cursorMoveHandler,this),this.endDrag(t.changedTouches[0].x,t.changedTouches[0].y),t.event.preventDefault()},DragRoll.prototype.mouseUpHandler=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.cursorMoveHandler,this),this.endDrag(t.x,t.y))},DragRoll.prototype.cursorMoveHandler=function(t){this.app.touch?this.doRayCast(t.changedTouches?t.changedTouches[0]:t):this.doRayCast(t),this.dragging=!0},DragRoll.prototype.doRayCast=function(t){if(!0!==this.rolling&&!1!==this.enabled){var e=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),i=this.app.systems.rigidbody.raycastFirst(this.cameraEntity.getPosition(),e);if(i&&!0===i.entity.dragRollTarget){var r=i.point,o=this.arrowEntity.getPosition();this.side0=r.x-o.x,this.side1=r.z-o.z;var a=o.distance(r),s=(90+180*Math.asin(this.side1/a)/Math.PI)*(r.x>o.x?-1:1);s>=-25&&s<=25&&(this.arrowEntity.setLocalScale(.75*a,1,1.8*a),this.arrowEntity.setLocalEulerAngles(0,s,0))}}},DragRoll.prototype.endDrag=function(t,e){!1===this.dragging||!0===this.rolling||!1===this.enabled||0===this.side0&&0===this.side1||(this.entity.rigidbody.applyImpulse(new pc.Vec3(this.side0*this.dragVelXMultiplier,0,pc.math.clamp(this.side1*this.dragVelZMultiplier,-this.maxForce,-this.minForce))),setTimeout(this.resetArrow,1e3),this.rolling=!0,this.dragging=!1)},DragRoll.prototype.resetArrow=function(){this.arrowEntity.setLocalScale(1,1,1),this.arrowEntity.setLocalEulerAngles(0,0,0)},DragRoll.prototype.gameOverHandler=function(){this.enabled=this.arrowEntity.enabled=!1,this.entity.model.hide()},DragRoll.prototype.gameRestartHandler=function(){this.enabled=this.arrowEntity.enabled=!0,this.entity.model.show()};var DragRollTarget=pc.createScript("dragRollTarget");DragRollTarget.prototype.initialize=function(){this.entity.dragRollTarget=!0},DragRollTarget.prototype.update=function(t){};var Clickable=pc.createScript("clickable");Clickable.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),Clickable.prototype.initialize=function(){this.app.touch?this.app.touch.on(pc.EVENT_TOUCHSTART,this.clickHandler,this):this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.clickHandler,this)},Clickable.prototype.clickHandler=function(t){this.doRayCast(t.changedTouches?t.changedTouches[0]:t)},Clickable.prototype.doRayCast=function(t){var i=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),a=this.app.systems.rigidbody.raycastFirst(this.cameraEntity.getPosition(),i);a&&a.entity.name===this.entity.name&&window.MobileFuse.sendMessage(a.entity.name+"Tap")};var SwitchingTextures=pc.createScript("switchingTextures");SwitchingTextures.attributes.add("textures",{type:"asset",assetType:"texture",array:!0,title:"Textures"}),SwitchingTextures.attributes.add("changeOnSpin",{type:"boolean",default:!1,title:"Change On Spin",description:"Whether textures should be re-assigned as the entity spins"}),SwitchingTextures.attributes.add("emissive",{type:"boolean",default:!1,title:"Emissive?",description:"Whether the textures should be assigned as emissive"}),SwitchingTextures.attributes.add("textureIndex",{type:"number",default:0,title:"Texture Index"}),SwitchingTextures.prototype.initialize=function(){this.setInitialTextures=this.setInitialTextures.bind(this),this.initializeTextureAssignment=this.initializeTextureAssignment.bind(this),setTimeout(this.initializeTextureAssignment,50)},SwitchingTextures.prototype.initializeTextureAssignment=function(){try{this.configTextureData=window.MobileFuse.PC_CONFIG.textures,this.app.loader.getHandler("texture").crossOrigin="anonymous",this.changeOnSpin=!0===this.configTextureData.changeOnSpin,this.loadedTextures=0,this.texturesArray=[],this.entity.texturesLoaded=!1,this.emissive=!0===this.configTextureData.emissive,this.alertReady=this.alertReady.bind(this),Array.isArray(this.configTextureData.imageNames[0])?this.imageNamesArray=this.configTextureData.imageNames[this.entity.baseEntityIndex].slice():this.imageNamesArray=this.configTextureData.imageNames.slice();for(var t=0;t<this.imageNamesArray.length;t++){console.log(this.textureIndex||t,this.textureIndex,t);var e=new pc.Asset("texture_"+(this.entity.baseEntityIndex||0)+"-"+(this.textureIndex||t),"texture",{url:this.configTextureData.imageFolder+this.imageNamesArray[this.textureIndex||t]});this.app.assets.add(e),e.on("load",this.externalImageLoadCompleteHandler,this),e.on("error",this.externalImageLoadErrorHandler,this),this.app.assets.load(e)}}catch(t){this.texturesArray=this.textures.slice(),setTimeout(this.setInitialTextures,50)}},SwitchingTextures.prototype.externalImageLoadCompleteHandler=function(t){var e=Number(t.name.split("-")[1]);this.texturesArray[e]=this.textures[e]=t,this.loadedTextures++,this.loadedTextures==this.imageNamesArray.length&&this.setInitialTextures()},SwitchingTextures.prototype.externalImageLoadErrorHandler=function(t){console.log(t)},SwitchingTextures.prototype.setInitialTextures=function(){if(this.entity._children[0].model)for(var t=Math.min(this.texturesArray.length,this.entity._children.length),e=0;e<t;e++){var i=this.entity._children[e];i.model.material=i.model.material.clone(),i.model.material.ambientTint=!1,this.setFaceTexture(e)}else{this.entity.model.material=this.entity.model.material.clone(),this.entity.model.material.ambientTint=!1;var s=!0===this.emissive?"emissiveMap":"diffuseMap",r=this.imageNamesArray[0];console.log(this.texturesArray),this.entity.model.material[s]=this.texturesArray[this.textureIndex||0].resource,this.entity.model.material[s].anisotropy=7,r.indexOf(".png")===r.length-4&&(this.entity.model.material.opacityMap=this.texturesArray[textureIndex].resource,this.entity.model.material.opacityMapChannel="a",this.entity.model.material.blendType=pc.BLEND_NORMAL),this.entity.model.material.update()}this.addRotationListeners(),this.entity.texturesLoaded=!0,setTimeout(this.alertReady,100)},SwitchingTextures.prototype.alertReady=function(){this.app.fire("textures:ready")},SwitchingTextures.prototype.setFaceTexture=function(t,e){void 0===e&&(e=t);var i=this.entity._children[t],s=!0===this.emissive?"emissiveMap":"diffuseMap",r=this.imageNamesArray[e];i.model.material[s]=this.texturesArray[e].resource,r.indexOf(".png")===r.length-4&&(i.model.material.opacityMap=this.texturesArray[e].resource,i.model.material.opacityMapChannel="a",i.model.material.blendType=pc.BLEND_NORMAL),i.model.material.update(),this.texturesArray.length>this.entity._children.length&&(i.model.entity.clickID="Plane_"+this.entity.baseEntityIndex+"-"+this.textures.indexOf(this.texturesArray[e]))},SwitchingTextures.prototype.addRotationListeners=function(){this.changeOnSpin&&this.entity._children.length<this.texturesArray.length&&this.entity.script.rotationTracker&&(this.frontPlaneIndex=0,this.app.on("rotationTracker:forward",this.forwardRotationHandler,this),this.app.on("rotationTracker:backward",this.backwardRotationHandler,this))},SwitchingTextures.prototype.forwardRotationHandler=function(t){t.entity.name===this.entity.name&&(this.texturesArray.push(this.texturesArray.shift()),this.updateTexturesOnRotation())},SwitchingTextures.prototype.backwardRotationHandler=function(t){t.entity.name===this.entity.name&&(this.texturesArray.unshift(this.texturesArray.pop()),this.updateTexturesOnRotation())},SwitchingTextures.prototype.updateTexturesOnRotation=function(){this.setFaceTexture(this.frontPlaneIndex,1),this.frontPlaneIndex=1===this.frontPlaneIndex?0:1,this.setFaceTexture(this.frontPlaneIndex,0)};var Boot=pc.createScript("boot");Boot.prototype.initialize=function(){void 0!==window.MobileFuse||"playcanv.as"!=window.location.hostname&&"launch.playcanvas.com"!==window.location.hostname||(window.MobileFuse={PC_CONFIG:{testing:!0,spanish:!0,textures:{imageFolder:"https://d3tj5wcy4685ia.cloudfront.net/FLLottery_SkeeBall/",imageNames:["screen_v2.jpg","bg_v2.jpg"],changeOnSpin:!1,emissive:!1},numberColors:[[0,0,0,1],[255,255,255,1],[0,0,0,1],[255,255,255,1],[0,0,0,1]]},sendMessage:function(t){console.log("SEND:",t)}}),console.log("Config Data:",window.MobileFuse),this.MODEL_TAGS=["HyperCube","HyperPlane","OrientationCylinder","screenPlane","bg_plane"],this.baseEntityTexturesLoaded=0,this.canvasFound=!1,this.checkForCanvas=this.checkForCanvas.bind(this),this.app.on("textures:ready",this.texturesReadyHandler,this),this.findBaseEntities(),this.buildStyles(),this.checkForCanvas()},Boot.prototype.findBaseEntities=function(){this.baseEntitiesArray=[];for(var t=0;t<this.MODEL_TAGS.length;t++)this.baseEntitiesArray=this.baseEntitiesArray.concat(this.app.root.findByTag(this.MODEL_TAGS[t]));console.log(this.baseEntitiesArray)},Boot.prototype.checkForCanvas=function(){try{this.canvas=document.getElementsByTagName("canvas")[0],this.canvas.classList.add("app-canvas"),this.canvasFound=!0,this.checkReady()}catch(t){setTimeout(this.checkForCanvas,100)}},Boot.prototype.texturesReadyHandler=function(){this.baseEntityTexturesLoaded++,window.MobileFuse.PC_BOOT=!0,this.checkReady()},Boot.prototype.checkReady=function(){!0===this.canvasFound&&this.baseEntityTexturesLoaded===this.baseEntitiesArray.length&&this.alertReady()},Boot.prototype.alertReady=function(){this.canvas.classList.add("visible"),this.app.fire("Boot:ready",this);for(var t=0;t<this.baseEntitiesArray.length;t++){var e=!0,i=this.baseEntitiesArray[t];try{e=void 0!==window.MobileFuse.PC_CONFIG.animation&&window.MobileFuse.PC_CONFIG.animation.loops>0}catch(t){}e&&void 0!==i.openingAnimation&&setTimeout(i.openingAnimation.bind(i),600)}},Boot.prototype.buildStyles=function(){var t=document.createElement("style"),e=[".app-canvas {","    opacity: 0;","}",".app-canvas.visible {","     opacity: 1;","    -webkit-transition: opacity .5s;","    -moz-transition: opacity .5s;","    -ms-transition: opacity .5s;","    -o-transition: opacity .5s;","    transition: opacity .5s;","}"].join("\n");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.head.appendChild(t)};var AssignNumberColors=pc.createScript("assignNumberColors");AssignNumberColors.attributes.add("colorValueIndex",{type:"number"}),AssignNumberColors.prototype.initialize=function(){},AssignNumberColors.prototype.update=function(o){};